<%- include("partials/header") %>
<div class="main-container">
	<div class="left-container">
		<div class="upload-img" style="position: relative">
			<div class="upload-section" id="upload-section">
				<label for="file-upload" class="upload-label">
					Upload an Image
					<input
						type="file"
						id="file-upload"
						class="upload-input"
						accept="image/*"
					/>
				</label>
			</div>
			<div
				class="preview-section"
				id="preview-section"
				style="display: none"
			>
				<img id="preview" alt="Preview" />
				<button id="remove-btn" class="remove-btn">X</button>
			</div>
			<button class="calculate-btn">Calculate</button>
		</div>
		<div class="chat">Chat</div>
	</div>
	<div class="right-container">
		<div class="ingredients">
			<div class="ingredients-header">
				<h3>Ingredients</h3>
				<button class="add-ingredient-btn">+ Add Ingredient</button>
			</div>
			<div class="ingredients-list">
				<div class="ingredient-item">
					<div class="ingredient-details">
						<span class="ingredient-name">Chicken Breast</span>
						<span class="ingredient-quantity">200g</span>
					</div>
					<div class="ingredient-calories">180 Calories</div>
					<div class="ingredient-actions">
						<button class="edit-btn">✏️</button>
						<button class="remove-btn">X</button>
					</div>
				</div>
				<div class="ingredient-item">
					<div class="ingredient-details">
						<span class="ingredient-name">Rice</span>
						<span class="ingredient-quantity">150g</span>
					</div>
					<div class="ingredient-calories">220 Calories</div>
					<div class="ingredient-actions">
						<button class="edit-btn">✏️</button>
						<button class="remove-btn">X</button>
					</div>
				</div>
			</div>
			<div class="total-calories">Total Calories: 400</div>
		</div>
	</div>
</div>
<script>
	const fileInput = document.getElementById("file-upload");
	const previewImage = document.getElementById("preview");
	const uploadSection = document.getElementById("upload-section");
	const previewSection = document.getElementById("preview-section");
	const removeButton = document.getElementById("remove-btn");
    const calculateButton = document.querySelector(".calculate-btn");
    const validFileTypes = ["image/jpeg", "image/png", "image/jpg", "image/gif", "imgage/webp"];
    let base64Image = undefined;
    let imgFileType = undefined;

	// Reset the file input to allow re-uploading after removal
	function resetFileInput() {
		fileInput.value = ""; // Clear the file input value
	}

	fileInput.addEventListener("change", (event) => {
		const file = event.target.files[0];
		if (file) {
            console.log("File type " + file.type);
            imgFileType = file.type;

            if (!validFileTypes.includes(imgFileType)) {
                alert("Please upload a valid image file.");
                resetFileInput();
                return;
            }

			const reader = new FileReader();
			reader.onload = (e) => {
                base64Image = e.target.result;
				previewImage.src = e.target.result;
				uploadSection.style.display = "none";
				previewSection.style.display = "flex";
			};
			reader.readAsDataURL(file);
		}
	});

	removeButton.addEventListener("click", () => {
		previewImage.src = "";
		previewSection.style.display = "none";
		uploadSection.style.display = "flex";
		resetFileInput(); // Reset the file input
	});

    calculateButton.addEventListener("click", () => {
        if (!base64Image) {-
            alert("Please upload an image first.");
            return;
        }
        
        fetch("/upload", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                image: base64Image,
                type: imgFileType
            })
        })
    })

</script>
